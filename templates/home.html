{% extends "base.html" %}

{% block title %}Dashboard - Minhas Finanças{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/analise-categorias.css') }}">
{% endblock %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="periodo-selector">
    <h1>Visão Geral Financeira</h1>
    <div class="periodo-controls">
        <form method="GET" action="{{ url_for('main.home') }}" class="form-periodo">
            <select name="mes" id="mes" onchange="this.form.submit()">
                {% for mes_item in meses %}
                    <option value="{{ mes_item.numero }}" {% if mes_item.numero == mes_selecionado %}selected{% endif %}>
                        {{ mes_item.nome }}
                    </option>
                {% endfor %}
            </select>
            <select name="ano" id="ano" onchange="this.form.submit()">
                {% for ano in range(2020, 2030) %}
                    <option value="{{ ano }}" {% if ano == ano_selecionado %}selected{% endif %}>{{ ano }}</option>
                {% endfor %}
            </select>
        </form>
        <a href="{{ url_for('main.home') }}" class="btn-hoje" title="Ir para o mês atual">
            <span class="material-symbols-outlined">today</span>
            <span>Hoje</span>
        </a>
    </div>
</div>

<div class="cards-container">
    <div class="cards-row-unified">
        {% for conta in contas_corrente %}
            <div class="card-conta">
                <div class="card-header">
                    {% if conta.imagem_arquivo %}
                        <div class="card-icon-custom">
                            <img src="{{ url_for('static', filename='uploads/' + conta.imagem_arquivo) }}" alt="{{ conta.nome }}">
                        </div>
                    {% else %}
                        <span class="material-symbols-outlined">account_balance</span>
                    {% endif %}
                    <h4>{{ conta.nome }}</h4>
                </div>
                <div class="card-value">R$ {{ conta.saldo_atual|moeda }}</div>
            </div>
        {% endfor %}
        
        <div class="card-total card-corrente">
            <div class="card-header">
                <span class="material-symbols-outlined">account_balance_wallet</span>
                <h4>Total das Contas Correntes</h4>
            </div>
            <div class="card-value">R$ {{ total_corrente|moeda }}</div>
        </div>
        
        {% if total_investimento > 0 %}
            <div class="card-total card-investimento">
                <div class="card-header">
                    <span class="material-symbols-outlined">savings</span>
                    <h4>Total Investimento</h4>
                </div>
                <div class="card-value">R$ {{ total_investimento|moeda }}</div>
            </div>
        {% endif %}
    </div>
</div>

<div class="resumo-executivo">
    <h3>Resumo do Mês</h3>
    <div class="resumo-cards">
        <div class="resumo-card">
            <span class="material-symbols-outlined" style="color: #28a745;">trending_up</span>
            <div>
                <span class="resumo-label">Total de Receitas</span>
                <span class="resumo-value receita">R$ {{ total_receitas|moeda }}</span>
            </div>
        </div>
        <div class="resumo-card">
            <span class="material-symbols-outlined" style="color: #dc3545;">trending_down</span>
            <div>
                <span class="resumo-label">Total de Despesas</span>
                <span class="resumo-value despesa">R$ {{ total_despesas|moeda }}</span>
            </div>
        </div>
        <div class="resumo-card {{ 'positivo' if (total_corrente + total_receitas_pendentes - total_despesas_pendentes - total_faturas_pendentes) >= 0 else 'negativo' }}">
            <span class="material-symbols-outlined">
                {{ 'account_balance' if (total_corrente + total_receitas_pendentes - total_despesas_pendentes - total_faturas_pendentes) >= 0 else 'error' }}
            </span>
            <div>
                <span class="resumo-label">Resultado do Mês</span>
                <span class="resumo-value">R$ {{ (total_corrente + total_receitas_pendentes - total_despesas_pendentes - total_faturas_pendentes)|moeda }}</span>
            </div>
        </div>
    </div>
</div>

<div class="analise-categorias-container" style="margin-bottom: 20px;">
    <div class="analise-header">
        <h3>
            <span class="material-symbols-outlined">analytics</span>
            Análise Detalhada por Categoria
        </h3>
        <div class="analise-actions">
            <button type="button" class="btn btn-sm" id="btn-expandir-todas" style="font-size: 12px; padding: 6px 12px;">
                <span class="material-symbols-outlined" style="font-size: 16px;">expand_more</span>
                Expandir Todas
            </button>
            <button type="button" class="btn btn-sm" id="btn-colapsar-todas" style="font-size: 12px; padding: 6px 12px;">
                <span class="material-symbols-outlined" style="font-size: 16px;">expand_less</span>
                Colapsar Todas
            </button>
        </div>
    </div>
    
    <table class="tabela-analise">
        <thead>
            <tr>
                <th>Item</th>
                <th class="col-valor">Valor</th>
                <th class="col-percentual">%</th>
            </tr>
        </thead>
        <tbody>
            {% if analise_categorias.despesas %}
                {% for categoria in analise_categorias.despesas %}
                <tr class="row-categoria">
                    <td>
                        <div class="categoria-info">
                            {% if categoria.subcategorias %}
                            <button type="button" 
                                    class="btn-toggle-categoria" 
                                    id="btn-toggle-{{ categoria.id }}"
                                    onclick="toggleSubcategorias('{{ categoria.id }}')">
                                <span class="material-symbols-outlined">chevron_right</span>
                            </button>
                            {% else %}
                            <span style="display: inline-block; width: 30px;"></span>
                            {% endif %}
                            <span class="categoria-icon" style="background-color: {{ categoria.cor }};">
                                <span class="material-symbols-outlined">{{ categoria.icone }}</span>
                            </span>
                            <span class="categoria-nome">{{ categoria.nome }}</span>
                        </div>
                    </td>
                    <td class="col-valor valor-despesa">R$ {{ categoria.total|moeda }}</td>
                    <td class="col-percentual">
                        <div class="percentual-bar">
                            <span class="percentual-value percentual-dinamico" 
                                  data-valor="{{ categoria.total }}">
                                {% if analise_categorias.total_despesas > 0 %}
                                    {{ ((categoria.total / (analise_categorias.total_despesas + analise_categorias.total_investimentos)) * 100)|round(1) }}%
                                {% else %}
                                    0%
                                {% endif %}
                            </span>
                            <div class="percentual-visual">
                                <div class="percentual-fill despesa" 
                                     data-width="{% if analise_categorias.total_despesas > 0 %}{{ ((categoria.total / (analise_categorias.total_despesas + analise_categorias.total_investimentos)) * 100)|round(1) }}%{% else %}0%{% endif %}"
                                     style="width: 0;"></div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% for subcategoria in categoria.subcategorias %}
                <tr class="row-subcategoria subcategoria-{{ categoria.id }}">
                    <td>{{ subcategoria.nome }}</td>
                    <td class="col-valor">R$ {{ subcategoria.valor|moeda }}</td>
                    <td class="col-percentual">
                        <span class="percentual-value">
                            {% if categoria.total > 0 %}
                                {{ ((subcategoria.valor / categoria.total) * 100)|round(1) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
                {% endfor %}
                
                <tr class="row-total-secao">
                    <td>
                        <strong>Total de Despesas</strong>
                        <span class="badge-secao badge-despesa">{{ analise_categorias.despesas|length }} categorias</span>
                    </td>
                    <td class="col-valor valor-despesa" id="total-despesas" data-valor="{{ analise_categorias.total_despesas }}">
                        <strong>R$ {{ analise_categorias.total_despesas|moeda }}</strong>
                    </td>
                    <td class="col-percentual">
                        <strong>
                            {% if (analise_categorias.total_despesas + analise_categorias.total_investimentos) > 0 %}
                                {{ ((analise_categorias.total_despesas / (analise_categorias.total_despesas + analise_categorias.total_investimentos)) * 100)|round(1) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </strong>
                    </td>
                </tr>
            {% endif %}
            
            {% if analise_categorias.investimentos %}
                {% for investimento in analise_categorias.investimentos %}
                <tr class="row-categoria">
                    <td>
                        <div class="categoria-info">
                            <span style="display: inline-block; width: 30px;"></span>
                            <span class="categoria-icon" style="background-color: #007bff;">
                                <span class="material-symbols-outlined">savings</span>
                            </span>
                            <span class="categoria-nome">{{ investimento.nome }}</span>
                        </div>
                    </td>
                    <td class="col-valor valor-investimento">R$ {{ investimento.valor|moeda }}</td>
                    <td class="col-percentual">
                        <div class="percentual-bar">
                            <span class="percentual-value">
                                {% if (analise_categorias.total_despesas + analise_categorias.total_investimentos) > 0 %}
                                    {{ ((investimento.valor / (analise_categorias.total_despesas + analise_categorias.total_investimentos)) * 100)|round(1) }}%
                                {% else %}
                                    0%
                                {% endif %}
                            </span>
                            <div class="percentual-visual">
                                <div class="percentual-fill investimento" 
                                     data-width="{% if (analise_categorias.total_despesas + analise_categorias.total_investimentos) > 0 %}{{ ((investimento.valor / (analise_categorias.total_despesas + analise_categorias.total_investimentos)) * 100)|round(1) }}%{% else %}0%{% endif %}"
                                     style="width: 0;"></div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                
                <tr class="row-total-secao">
                    <td>
                        <strong>Total de Investimentos</strong>
                        <span class="badge-secao badge-investimento">{{ analise_categorias.investimentos|length }} contas</span>
                    </td>
                    <td class="col-valor valor-investimento" id="total-investimentos" data-valor="{{ analise_categorias.total_investimentos }}">
                        <strong>R$ {{ analise_categorias.total_investimentos|moeda }}</strong>
                    </td>
                    <td class="col-percentual">
                        <strong>
                            {% if (analise_categorias.total_despesas + analise_categorias.total_investimentos) > 0 %}
                                {{ ((analise_categorias.total_investimentos / (analise_categorias.total_despesas + analise_categorias.total_investimentos)) * 100)|round(1) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </strong>
                    </td>
                </tr>
            {% endif %}
            
            {% if analise_categorias.receitas %}
                {% for categoria in analise_categorias.receitas %}
                <tr class="row-categoria">
                    <td>
                        <div class="categoria-info">
                            {% if categoria.subcategorias %}
                            <button type="button" 
                                    class="btn-toggle-categoria" 
                                    id="btn-toggle-rec-{{ categoria.id }}"
                                    onclick="toggleSubcategorias('rec-{{ categoria.id }}')">
                                <span class="material-symbols-outlined">chevron_right</span>
                            </button>
                            {% else %}
                            <span style="display: inline-block; width: 30px;"></span>
                            {% endif %}
                            <span class="categoria-icon" style="background-color: {{ categoria.cor }};">
                                <span class="material-symbols-outlined">{{ categoria.icone }}</span>
                            </span>
                            <span class="categoria-nome">{{ categoria.nome }}</span>
                        </div>
                    </td>
                    <td class="col-valor valor-receita">R$ {{ categoria.total|moeda }}</td>
                    <td class="col-percentual">
                        <div class="percentual-bar">
                            <span class="percentual-value">
                                {% if analise_categorias.total_receitas > 0 %}
                                    {{ ((categoria.total / analise_categorias.total_receitas) * 100)|round(1) }}%
                                {% else %}
                                    0%
                                {% endif %}
                            </span>
                            <div class="percentual-visual">
                                <div class="percentual-fill receita" 
                                     data-width="{% if analise_categorias.total_receitas > 0 %}{{ ((categoria.total / analise_categorias.total_receitas) * 100)|round(1) }}%{% else %}0%{% endif %}"
                                     style="width: 0;"></div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% for subcategoria in categoria.subcategorias %}
                <tr class="row-subcategoria subcategoria-rec-{{ categoria.id }}">
                    <td>{{ subcategoria.nome }}</td>
                    <td class="col-valor">R$ {{ subcategoria.valor|moeda }}</td>
                    <td class="col-percentual">
                        <span class="percentual-value">
                            {% if categoria.total > 0 %}
                                {{ ((subcategoria.valor / categoria.total) * 100)|round(1) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
                {% endfor %}
                
                <tr class="row-total-secao">
                    <td>
                        <strong>Total de Receitas</strong>
                        <span class="badge-secao badge-receita">{{ analise_categorias.receitas|length }} categorias</span>
                    </td>
                    <td class="col-valor valor-receita" id="total-receitas" data-valor="{{ analise_categorias.total_receitas }}">
                        <strong>R$ {{ analise_categorias.total_receitas|moeda }}</strong>
                    </td>
                    <td class="col-percentual">
                        <strong>100%</strong>
                    </td>
                </tr>
            {% endif %}
            
            <tr class="row-resultado-final {{ 'positivo' if analise_categorias.economia_mes >= 0 else 'negativo' }}">
                <td>
                    <strong>
                        {% if analise_categorias.economia_mes >= 0 %}
                            📈 ECONOMIA DO MÊS
                        {% else %}
                            📉 DÉFICIT DO MÊS
                        {% endif %}
                    </strong>
                    <br>
                    <small style="color: #6c757d; font-weight: normal;">
                        (Receitas - Despesas - Investimentos)
                    </small>
                </td>
                <td class="col-valor">
                    <strong style="font-size: 18px;">
                        R$ {{ analise_categorias.economia_mes|moeda }}
                    </strong>
                </td>
                <td class="col-percentual">
                    <strong>
                        {% if analise_categorias.total_receitas > 0 %}
                            {{ ((analise_categorias.economia_mes / analise_categorias.total_receitas) * 100)|round(1) }}%
                        {% else %}
                            --
                        {% endif %}
                    </strong>
                </td>
            </tr>
        </tbody>
    </table>
    
    {% if not analise_categorias.despesas and not analise_categorias.investimentos and not analise_categorias.receitas %}
    <div class="sem-dados">
        <span class="material-symbols-outlined" style="font-size: 48px; color: #dee2e6;">bar_chart</span>
        <p>Nenhum lançamento registrado neste período para análise.</p>
    </div>
    {% endif %}
</div>

<div class="tabelas-container">
    <div class="tabela-section">
        <div class="tabela-header">
            <h3>
                <span class="material-symbols-outlined">trending_up</span>
                Receitas
            </h3>
            <div class="total-badge receita">R$ {{ total_receitas|moeda }}</div>
        </div>
        {% if receitas %}
            <div class="table-wrapper">
                <table class="tabela-lancamentos">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Data</th>
                            <th>Descrição</th>
                            <th>Categoria</th>
                            <th>Valor</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lancamento in receitas %}
                            <tr class="{{ 'row-pago' if lancamento.status == 'pago' else '' }}">
                                <td class="col-status">
                                    <button class="btn-status {{ 'status-pago' if lancamento.status == 'pago' else 'status-pendente' }}" 
                                            onclick="togglePagamento({{ lancamento.id }})"
                                            title="{{ 'Marcar como pendente' if lancamento.status == 'pago' else 'Marcar como pago' }}">
                                        <span class="material-symbols-outlined">
                                            {{ 'check_circle' if lancamento.status == 'pago' else 'radio_button_unchecked' }}
                                        </span>
                                    </button>
                                </td>
                                <td>
                                    {{ lancamento.data_vencimento.strftime('%d/%m') }}
                                    {% if lancamento.data_vencimento < today and lancamento.status != 'pago' %}
                                        <span class="badge-vencido">Vencido</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ lancamento.descricao }}
                                    {% if lancamento.tag %}
                                        <span class="tag-mini">{{ lancamento.tag }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="categoria-mini" style="color: {{ lancamento.categoria.cor }};">
                                        {{ lancamento.categoria.nome }}
                                    </span>
                                </td>
                                <td class="col-valor receita">R$ {{ lancamento.valor|moeda }}</td>
                                <td class="col-acoes">
                                    <button class="btn-icon-mini btn-edit" 
                                            onclick="editarLancamento({{ lancamento.id }})"
                                            title="Editar">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button class="btn-icon-mini btn-delete" 
                                            onclick="confirmarExclusao({{ lancamento.id }}, '{{ lancamento.descricao }}', '{{ lancamento.recorrencia }}')"
                                            title="Excluir">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-table">
                <span class="material-symbols-outlined">inbox</span>
                <p>Nenhuma receita neste período</p>
            </div>
        {% endif %}
    </div>
    
    <div class="tabela-section">
        <div class="tabela-header">
            <h3>
                <span class="material-symbols-outlined">trending_down</span>
                Despesas
            </h3>
            <div class="total-badge despesa">R$ {{ total_despesas|moeda }}</div>
        </div>
        {% if despesas %}
            <div class="table-wrapper">
                <table class="tabela-lancamentos">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Data</th>
                            <th>Descrição</th>
                            <th>Categoria</th>
                            <th>Valor</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lancamento in despesas %}
                            <tr class="{{ 'row-pago' if lancamento.status == 'pago' else '' }}">
                                <td class="col-status">
                                    {% if lancamento.tipo != 'fatura_cartao' %}
                                        <button class="btn-status {{ 'status-pago' if lancamento.status == 'pago' else 'status-pendente' }}" 
                                                onclick="togglePagamento({{ lancamento.id }})"
                                                title="{{ 'Marcar como pendente' if lancamento.status == 'pago' else 'Marcar como pago' }}">
                                            <span class="material-symbols-outlined">
                                                {{ 'check_circle' if lancamento.status == 'pago' else 'radio_button_unchecked' }}
                                            </span>
                                        </button>
                                    {% else %}
                                        <span class="btn-status {{ 'status-pago' if lancamento.status == 'pago' else 'status-pendente' }}"
                                              title="{{ 'Fatura paga' if lancamento.status == 'pago' else 'Fatura pendente' }}">
                                            <span class="material-symbols-outlined">
                                                {{ 'check_circle' if lancamento.status == 'pago' else 'credit_card' }}
                                            </span>
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ lancamento.data_vencimento.strftime('%d/%m') }}
                                    {% if lancamento.data_vencimento < today and lancamento.status != 'pago' %}
                                        <span class="badge-vencido">Vencido</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ lancamento.descricao }}
                                    {% if lancamento.tag %}
                                        <span class="tag-mini">{{ lancamento.tag }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="categoria-mini" style="color: {{ lancamento.categoria.cor }};">
                                        {{ lancamento.categoria.nome }}
                                    </span>
                                </td>
                                <td class="col-valor despesa">R$ {{ lancamento.valor|moeda }}</td>
                                <td class="col-acoes">
                                    {% if lancamento.tipo != 'fatura_cartao' %}
                                        <button class="btn-icon-mini btn-edit" 
                                                onclick="editarLancamento({{ lancamento.id }})"
                                                title="Editar">
                                            <span class="material-symbols-outlined">edit</span>
                                        </button>
                                        <button class="btn-icon-mini btn-delete" 
                                                onclick="confirmarExclusao({{ lancamento.id }}, '{{ lancamento.descricao }}', '{{ lancamento.recorrencia }}')"
                                                title="Excluir">
                                            <span class="material-symbols-outlined">delete</span>
                                        </button>
                                    {% else %}
                                        <a href="{{ url_for('main.extrato_cartao', mes=mes_selecionado, ano=ano_selecionado, cartao_id=lancamento.cartao_id) }}" 
                                           class="btn-icon-mini btn-view" 
                                           title="Ver extrato completo"
                                           style="color: #6f42c1;">
                                            <span class="material-symbols-outlined">receipt_long</span>
                                        </a>
                                        {% if lancamento.status != 'pago' %}
                                            <button class="btn-icon-mini btn-pay" 
                                                    onclick="marcarFaturaPaga({{ lancamento.cartao_id }}, '{{ lancamento.cartao.nome }}', {{ lancamento.valor }}, '{{ lancamento.data_vencimento }}')"
                                                    title="Pagar fatura"
                                                    style="color: #28a745;">
                                                <span class="material-symbols-outlined">payment</span>
                                            </button>
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-table">
                <span class="material-symbols-outlined">inbox</span>
                <p>Nenhuma despesa neste período</p>
            </div>
        {% endif %}
    </div>
</div>

<form id="formPagamento" method="POST" style="display: none;">
    <input type="hidden" name="from_home" value="true">
    <input type="hidden" name="mes" value="{{ mes_selecionado }}">
    <input type="hidden" name="ano" value="{{ ano_selecionado }}">
</form>

<form id="formExclusao" method="POST" style="display: none;">
    <input type="hidden" name="excluir_todos" id="excluir_todos" value="false">
    <input type="hidden" name="from_home" value="true">
    <input type="hidden" name="mes" value="{{ mes_selecionado }}">
    <input type="hidden" name="ano" value="{{ ano_selecionado }}">
</form>

<div id="modalExclusao" class="home-modal">
    <div class="home-modal-content">
        <div class="home-modal-header modal-header-danger">
            <h3>
                <span class="material-symbols-outlined">warning</span>
                Confirmar Exclusão
            </h3>
            <span class="home-modal-close" onclick="fecharModalExclusao()">&times;</span>
        </div>
        <div class="home-modal-body">
            <div class="delete-warning-icon">
                <span class="material-symbols-outlined">delete_forever</span>
            </div>
            <p class="delete-message">
                Tem certeza que deseja excluir o lançamento <strong id="descricaoExcluir"></strong>?
            </p>
            
            <div id="opcaoRecorrencia" style="display: none;">
                <p class="delete-submessage">Este é um lançamento recorrente. O que deseja fazer?</p>
                <div class="delete-options">
                    <label class="delete-option">
                        <input type="radio" name="excluir_opcao" value="apenas_este" checked>
                        <span>Excluir apenas este lançamento</span>
                    </label>
                    <label class="delete-option">
                        <input type="radio" name="excluir_opcao" value="todos_futuros">
                        <span>Excluir este e todos os futuros</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="home-modal-actions">
            <button type="button" class="btn btn-secondary" onclick="fecharModalExclusao()">
                <span class="material-symbols-outlined">close</span>
                Cancelar
            </button>
            <button type="button" class="btn btn-danger" onclick="confirmarExclusaoFinal()">
                <span class="material-symbols-outlined">delete</span>
                Confirmar Exclusão
            </button>
        </div>
    </div>
</div>

<div id="modalEdicao" class="home-modal">
    <div class="home-modal-content">
        <div class="home-modal-header">
            <h3>
                <span class="material-symbols-outlined">edit</span>
                Editar Lançamento
            </h3>
            <span class="home-modal-close" onclick="fecharModalEdicao()">&times;</span>
        </div>
        <form id="formEdicao" method="POST">
            <input type="hidden" name="from_home" value="true">
            <input type="hidden" name="mes" value="{{ mes_selecionado }}">
            <input type="hidden" name="ano" value="{{ ano_selecionado }}">
            <input type="hidden" name="editar_todos" id="editar_todos" value="false">
            
            <div class="home-modal-body">
                <div class="form-group">
                    <label for="edit_descricao">Descrição</label>
                    <input type="text" id="edit_descricao" name="descricao" required>
                </div>
                
                <div class="form-group">
                    <label for="edit_valor">Valor (R$)</label>
                    <input type="text" id="edit_valor" name="valor" required>
                </div>
                
                <div class="form-group">
                    <label for="edit_data">Data de Vencimento</label>
                    <input type="date" id="edit_data" name="data_vencimento" required>
                </div>
                
                <div class="form-group">
                    <label for="edit_conta">Conta</label>
                    <select id="edit_conta" name="conta_id" required>
                        {% for conta in contas_corrente %}
                            <option value="{{ conta.id }}">{{ conta.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit_categoria">Categoria</label>
                    <select id="edit_categoria" name="categoria_id" required>
                        </select>
                </div>
                
                <div class="form-group">
                    <label for="edit_subcategoria">Subcategoria</label>
                    <select id="edit_subcategoria" name="subcategoria_id">
                        <option value="">Nenhuma</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit_tag">Tag</label>
                    <input type="text" id="edit_tag" name="tag" maxlength="50">
                </div>
                
                <div id="opcaoEdicaoRecorrencia" style="display: none;">
                    <p class="edit-submessage">Este é um lançamento recorrente. Deseja editar:</p>
                    <div class="edit-options">
                        <label class="edit-option">
                            <input type="radio" name="editar_opcao" value="apenas_este" checked>
                            <span>Apenas este lançamento</span>
                        </label>
                        <label class="edit-option">
                            <input type="radio" name="editar_opcao" value="todos_futuros">
                            <span>Este e todos os futuros</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="home-modal-actions">
                <button type="button" class="btn btn-secondary" onclick="fecharModalEdicao()">
                    <span class="material-symbols-outlined">close</span>
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    <span class="material-symbols-outlined">save</span>
                    Salvar Alterações
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/home.js') }}"></script>
<script src="{{ url_for('static', filename='js/analise-categorias.js') }}"></script>
{% endblock %}